WEBVTT
Kind: captions
Language: zh-CN

00:00:00.000 --> 00:00:06.410
最后 我们将向应用中添加本地通知

00:00:06.410 --> 00:00:11.070
这样的话 如果用户忘记记录某天的信息

00:00:11.070 --> 00:00:12.710
在晚上 8 点

00:00:12.710 --> 00:00:14.295
或你指定的任何时间

00:00:14.294 --> 00:00:18.000
手机上将弹出一条本地通知

00:00:18.000 --> 00:00:21.445
提醒“嘿 别忘了记录信息”

00:00:21.445 --> 00:00:24.449
首先

00:00:24.449 --> 00:00:27.271
导入 AsyncStorage

00:00:27.271 --> 00:00:31.544
然后从 expo 导入几项不同的属性

00:00:31.545 --> 00:00:36.170
首先是 Notifications 其次是 Permission

00:00:36.170 --> 00:00:42.765
然后创建一个 NOTIFICATION_KEY 就像之前一样

00:00:42.765 --> 00:00:49.554
将这个称为 UdaciFitness:notifications

00:00:49.554 --> 00:00:51.500
现在

00:00:51.500 --> 00:00:53.299
转到底部

00:00:53.299 --> 00:00:56.024
我们将创建三个不同的方法

00:00:56.024 --> 00:01:01.079
第一个称为 clearLocalNotification

00:01:01.079 --> 00:01:05.504
第二个称为 createNotification

00:01:05.504 --> 00:01:12.509
第三个称为 setLocalNotification

00:01:12.510 --> 00:01:15.115
先创建 createNotification

00:01:15.114 --> 00:01:17.864
它将返回一个对象

00:01:17.864 --> 00:01:20.359
表示通知

00:01:20.359 --> 00:01:25.560
title 将设为：挥手

00:01:25.560 --> 00:01:27.810
我喜欢这个图标 然后是 Log your stats

00:01:27.810 --> 00:01:32.670
body 将为… 我们将挥手图标用在 body 上

00:01:32.670 --> 00:01:36.144
body 将为挥手图标

00:01:36.144 --> 00:01:41.359
don't forget to log your stats for today!

00:01:41.359 --> 00:01:43.253
在 ios 上

00:01:43.253 --> 00:01:44.314
sound 当然为 true

00:01:44.314 --> 00:01:45.780
我们希望发出提示音

00:01:45.780 --> 00:01:49.924
在 Android 上有几个不同的选项

00:01:49.924 --> 00:01:51.719
当然要设置 sound

00:01:51.719 --> 00:01:56.745
priority 将非常的高

00:01:56.745 --> 00:01:59.755
sticky 设为 false 我们不希望保持这一消息

00:01:59.754 --> 00:02:02.625
vibrate 肯定为 true

00:02:02.625 --> 00:02:05.784
这些将表示通知

00:02:05.784 --> 00:02:07.280
现在 在 setLocalNotification 中

00:02:07.280 --> 00:02:12.259
我们希望检查下是否已经设置本地通知

00:02:12.259 --> 00:02:14.909
我们不希望再出现一个通知

00:02:14.909 --> 00:02:17.789
否则用户会收到两条、三条甚至更多的通知

00:02:17.789 --> 00:02:22.109
我们将使用 AsyncStorage

00:02:22.110 --> 00:02:28.330
并使用 getItem 检查 NOTIFICATION_KEY 是否已设置

00:02:28.330 --> 00:02:31.620
我们将获取 data

00:02:31.620 --> 00:02:35.300
实际上 在这里调用 JSON.parse

00:02:35.300 --> 00:02:37.770
然后

00:02:37.770 --> 00:02:40.060
检查是否成立

00:02:40.060 --> 00:02:41.835
获取 data

00:02:41.835 --> 00:02:45.000
如果 data === null

00:02:45.000 --> 00:02:48.030
表示我们尚未设置本地通知

00:02:48.030 --> 00:02:52.199
然后就像在上个视频中看到的一样

00:02:52.199 --> 00:02:53.959
我们将使用 Permissions

00:02:53.960 --> 00:02:56.094
这里应该改为 Permissions

00:02:56.094 --> 00:02:59.354
输入 askAsync

00:02:59.354 --> 00:03:04.109
我们要请求的权限是 Permissions.NOTIFICATIONS

00:03:04.110 --> 00:03:05.860
当我们获得相关内容后

00:03:05.860 --> 00:03:11.850
这个将是 status

00:03:11.849 --> 00:03:14.549
现在我们将输入

00:03:14.550 --> 00:03:17.945
如果 status 为 granted

00:03:17.944 --> 00:03:20.039
我们就可以继续了

00:03:20.039 --> 00:03:21.359
如果 status 为 granted

00:03:21.360 --> 00:03:30.750
则输入 Notifications.cancelAllScheduledNotificationsAsync

00:03:30.750 --> 00:03:33.777
如果我们已经设置了通知

00:03:33.777 --> 00:03:35.414
则取消该通知

00:03:35.414 --> 00:03:40.879
然后我们将设置此日期

00:03:40.879 --> 00:03:44.694
输入 tomorrow 对其调用 setDate

00:03:44.694 --> 00:03:46.979
这么做的原因是

00:03:46.979 --> 00:03:51.509
我们希望获取明天的时间 例如晚上 8 点

00:03:51.509 --> 00:03:56.639
因此输入 tomorrow.setHours 以及 tomorrow.setMinutes

00:03:56.639 --> 00:03:58.359
在晚上 8 点整时

00:03:58.360 --> 00:04:01.780
将显示这个 tomorrow 对象

00:04:01.780 --> 00:04:09.735
然后输入 Notifications.scheduleLocalNotificationsAsync

00:04:09.735 --> 00:04:14.281
首先传入 createNotification

00:04:14.281 --> 00:04:15.390
调用该函数

00:04:15.389 --> 00:04:17.260
以便获得该对象

00:04:17.261 --> 00:04:21.405
然后传入一些选项

00:04:21.404 --> 00:04:25.424
time 将为 tomorrow

00:04:25.425 --> 00:04:29.500
repeat 我们希望每天都重复

00:04:29.500 --> 00:04:33.459
然后在这里

00:04:33.459 --> 00:04:37.139
之后 我们希望确保

00:04:37.139 --> 00:04:41.894
在 AsyncStorage 中已经设置这个本地通知

00:04:41.894 --> 00:04:43.709
输入 setItem

00:04:43.709 --> 00:04:47.789
NOTIFICATION_KEY

00:04:47.790 --> 00:04:51.955
JSON.stringify 为 true

00:04:51.954 --> 00:04:56.995
看起来不错 应该没有任何拼写错误

00:04:56.995 --> 00:05:00.879
看看应用效果 不错

00:05:00.879 --> 00:05:04.625
这段代码的作用是 当我们调用 setLocalNotification 时

00:05:04.625 --> 00:05:06.274
我们将在下个视频中创建 setLocalNotification

00:05:06.274 --> 00:05:09.899
它将确保我们尚未设置本地通知

00:05:09.899 --> 00:05:13.564
如果尚未设置并且授予了权限

00:05:13.564 --> 00:05:17.375
我们将清空所有本地通知 以防设置两个通知

00:05:17.375 --> 00:05:20.920
创建一个表示明天晚上八点的 date 对象

00:05:20.920 --> 00:05:25.960
然后调用 scheduleLocalNotificationsAsync

00:05:25.959 --> 00:05:28.629
传入 createNotification

00:05:28.629 --> 00:05:31.569
何时显示通知 然后在本地存储上进行设置

00:05:31.569 --> 00:05:36.879
最后 我们需要构建 clearLocalNotification 函数

00:05:36.879 --> 00:05:38.944
这个函数很直白

00:05:38.944 --> 00:05:45.069
我们将调用 AsyncStorage.removeItem

00:05:45.069 --> 00:05:48.579
要移除的是 NOTIFICATION_KEY

00:05:48.579 --> 00:05:50.764
完毕后

00:05:50.764 --> 00:05:53.185
我们将调用

00:05:53.185 --> 00:05:59.425
Notifications.cancelAllScheduleNotificationsAsync

00:05:59.425 --> 00:06:02.000
以便删除所有通知

