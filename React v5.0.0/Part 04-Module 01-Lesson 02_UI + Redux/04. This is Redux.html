<!-- udacity2.0 -->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>This is Redux</title>
  <link rel="stylesheet" href="../assets/css/bootstrap.min.css">
  <link rel="stylesheet" href="../assets/css/plyr.css">
  <link rel="stylesheet" href="../assets/css/katex.min.css">
  <link rel="stylesheet" href="../assets/css/jquery.mCustomScrollbar.min.css">
  <link rel="stylesheet" href="../assets/css/styles.css">
  <link rel="shortcut icon" type="image/png" href="../assets/img/udacimak.png" />
</head>

<body>
  <div class="wrapper">
    <nav id="sidebar">
  <div class="sidebar-header">
    <h3>UI + Redux</h3>
  </div>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled components">
    <li class="">
      <a href="01. Introduction.html">01. Introduction</a>
    </li>
    <li class="">
      <a href="02. UI.html">02. UI</a>
    </li>
    <li class="">
      <a href="03. UI + State.html">03. UI + State</a>
    </li>
    <li class="">
      <a href="04. This is Redux.html">04. This is Redux</a>
    </li>
    <li class="">
      <a href="05. Summary.html">05. Summary</a>
    </li>
  </ul>

  <ul class="sidebar-list list-unstyled CTAs">
    <li>
      <a href="../index.html" class="article">Back to Home</a>
    </li>
  </ul>
</nav>

    <div id="content">
      <header class="container-fluild header">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <div class="align-items-middle">
                <button type="button" id="sidebarCollapse" class="btn btn-toggle-sidebar">
                  <div></div>
                  <div></div>
                  <div></div>
                </button>

                <h1 style="display: inline-block">04. This is Redux</h1>
              </div>
            </div>
          </div>
        </div>
      </header>

      <main class="container">
        <div class="row">
          <div class="col-12">
            <div class="ud-atom">
  <h3><p>This Is Redux</p></h3>
  <video controls>
  <source src="04. This Is Redux-06YeYJkrGaw.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="04. This Is Redux-06YeYJkrGaw.en.vtt" label="en">
  <track default="false" kind="subtitles" srclang="BR" src="04. This Is Redux-06YeYJkrGaw.pt-BR.vtt" label="BR">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>We're going to transition away from our custom code to using the actual Redux library. While we're working on this simple project, we'll be linkin to the hosted version of the Redux library. In the following video, we'll use this code to link to redux:</p>
<pre><code class="html language-html">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.7.2/redux.min.js"&gt;&lt;/script&gt;</code></pre>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>Adding In Redux</p></h3>
  <video controls>
  <source src="04. Adding In Redux-Sg482OZsFzM.mp4" type="video/mp4">

  <track default="true" kind="subtitles" srclang="en" src="04. Adding In Redux-Sg482OZsFzM.en.vtt" label="en">
  <track default="false" kind="subtitles" srclang="BR" src="04. Adding In Redux-Sg482OZsFzM.pt-BR.vtt" label="BR">
</video>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p><a href="https://github.com/udacity/reactnd-redux-todos-goals/commit/d4975c2245e6d590f637e0873d30ae8d6454e372" rel="noopener noreferrer" target="_blank">Here's the commit with the changes made in this video.</a></p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <div>
    <h4>Task Description:</h4>
    <p>Still following along? If so, make sure to check off each of these:</p>
  </div>

  <form>
    <fieldset>
      <legend>Task List:</legend>

      <div>
        <input type="checkbox" id="45ca65c2-c633-4d66-b31d-a745ec0fbaea--0">
        <label for="45ca65c2-c633-4d66-b31d-a745ec0fbaea--0"><p>I have linked to the Redux library.</p></label>
      </div>
      <div>
        <input type="checkbox" id="45ca65c2-c633-4d66-b31d-a745ec0fbaea--1">
        <label for="45ca65c2-c633-4d66-b31d-a745ec0fbaea--1"><p>I have deleted my custom <code>createStore()</code> function.</p></label>
      </div>
      <div>
        <input type="checkbox" id="45ca65c2-c633-4d66-b31d-a745ec0fbaea--2">
        <label for="45ca65c2-c633-4d66-b31d-a745ec0fbaea--2"><p>I have swapped my <code>createStore(app)</code> call with <code>Redux.createStore(app)</code> call.</p></label>
      </div>
      <div>
        <input type="checkbox" id="45ca65c2-c633-4d66-b31d-a745ec0fbaea--3">
        <label for="45ca65c2-c633-4d66-b31d-a745ec0fbaea--3"><p>I have replaced my <code>app()</code> function with <code>Redux.combineReducers()</code>.</p></label>
      </div>
      <div>
        <input type="checkbox" id="45ca65c2-c633-4d66-b31d-a745ec0fbaea--4">
        <label for="45ca65c2-c633-4d66-b31d-a745ec0fbaea--4"><p>I have tested everything, and my application still works!</p></label>
      </div>
    </fieldset>
  </form>

  <div>
    <h4>Task Feedback:</h4>


    <p>Fantastic work!</p>
  </div>
</div>


</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <p>Reducer composition sounds intimidating, but it's simpler than you might think. The idea is that you can create a reducer to manage not only each section of your Redux store, but also any nested data as well.<br />
Let's say we were dealing with a state tree like had this structure</p>
<pre><code class="js language-js">{
  users: {},
  setting: {},
  tweets: {
    btyxlj: {
      id: 'btyxlj',
      text: 'What is a jQuery?',
      author: {
        name: 'Tyler McGinnis',
        id: 'tylermcginnis',
        avatar: 'twt.com/tm.png'
      }   
    }
  }  
}</code></pre>
<p>We have three main properties on our state tree: users, settings, and tweets. Naturally, we'd create an individual reducer for both of those and then create a single root reducer using Redux's <code>combineReducers</code> method.</p>
<pre><code class="js language-js">const reducer = combineReducers({
  users,
  settings,
  tweets
})</code></pre>
<p><code>combineReducers</code>, under the hood, is our first look at reducer composition. <code>combineReducers</code> is responsible for invoking all the other reducers, passing them the portion of their state that they care about. We're making one root reducer, by composing a bunch of other reducers together. With that in mind, let's take a closer look at our tweets reducer and how we can leverage reducer composition again to make it more compartmentalized. Specifically, let's look how a user might change their avatar with the way our store is currently structured. Here's the skeleton with what we'll start out with -</p>
<pre><code class="js language-js">function tweets (state = {}, action) {
  switch(action.type){
      case ADD_TWEET :
        ...
      case REMOVE_TWEET :
        ...
      case UPDATE_AVATAR :
        ???
  }
}</code></pre>
<p>What we're interested in is that last one, <code>UPDATE_AVATAR</code>. This one is interesting because we have some nested data - and remember, reducers have to be pure and can't mutate any state. Here's one approach.</p>
<pre><code class="js language-js">function tweets (state = {}, action) {
  switch(action.type){
      case ADD_TWEET :
        ...
      case REMOVE_TWEET :
        ...
      case UPDATE_AVATAR :
        return {
          ...state,
          [action.tweetId]: {
            ...state[action.tweetId],
            author: {
              ...state[action.tweetId].author,
              avatar: action.newAvatar 
            }
          }
        }
  }
}</code></pre>
<p>That's a lot of spread operators. The reason for that is because, for every layer, we're wanting to spread all the properties of that layer on the new objects we're creating (because, immutability). What if, just like we separated our tweets, users, and settings reducers by passing them the slice of the state tree they care about, what if we do the same thing for our tweets reducer and its nested data.<br />
Doing that, the code above would be transformed to look like this</p>
<pre><code class="js language-js">function author (state, action) {
  switch (action.type) {
      case : UPDATE_AVATAR
        return {
          ...state,
          avatar: action.newAvatar
        }
      default :
        state
  }
}

function tweet (state, action) {
  switch (action.type) {
      case ADD_TWEET :
        ...
      case REMOVE_TWEET :
        ...
      case : UPDATE_AVATAR
        return {
          ...state,
          author: author(state.author, action)
        }
      default :
        state
  }
}

function tweets (state = {}, action) {
  switch(action.type){
      case ADD_TWEET :
        ...
      case REMOVE_TWEET :
        ...
      case UPDATE_AVATAR :
        return {
          ...state,
          [action.tweetId]: tweet(state[action.tweetId], action)
        }
      default :
        state
  }
}</code></pre>
<p>All we've done is separated out each layer of our nested tweets data into their own reducers. Then, just like we did with our root reducer, we're passing those reducers the slice of the state they care about.</p>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3><p>What's Wrong with this Root Reducer?</p></h3>
  <div>
  <form>
    <fieldset>
      <legend><p>What is wrong with the following root reducer?</p>
<pre><code class="js language-js">import { combineReducers } from 'redux';
import booksReducer from './books_reducer';
import userReducer from './user_reducer';

const rootReducer = combineReducers(booksReducer, userReducer);

export default rootReducer;</code></pre></legend>
    </fieldset>

      <div>
        <input type="radio" value="a1530635249102" name="669585" id="a1530635249102">
        <label for="a1530635249102"><p><code>combineReducers()</code> should be imported from <code>react-redux</code></p></label>
      </div>
      <div>
        <input type="radio" value="a1530635267291" name="669585" id="a1530635267291">
        <label for="a1530635267291"><p><code>combineReducers()</code> should be a curried function</p></label>
      </div>
      <div>
        <input type="radio" value="a1530635272450" name="669585" id="a1530635272450">
        <label for="a1530635272450"><p>The wrong value is being exported</p></label>
      </div>
      <div>
        <input type="radio" value="a1530635277920" name="669585" id="a1530635277920">
        <label for="a1530635277920"><p>An object that maps state keys to reducers should be passed into <code>combineReducers()</code></p></label>
      </div>
      <div>
        <input type="radio" value="a1530635283602" name="669585" id="a1530635283602">
        <label for="a1530635283602"><p><code>combineReducers()</code> should have the store passed into it instead</p></label>
      </div>
  </form>

  <details>
    <summary><strong>SOLUTION:</strong></summary>
    An object that maps state keys to reducers should be passed into `combineReducers()`
  </details>
</div>

</div>
<div class="divider"></div><div class="ud-atom">
  <h3></h3>
  <div>
  <h1 id="summary">Summary</h1>
<p>In this section, we replaced the code we wrote in the previous lesson with the actual Redux library code. We saw that swapping out our code with Redux's code didn't change anything with how our application functions or how our app-specific code works. Redux is <em>just</em> a predictable state container.</p>
<p>What's key to understand is that you've already learned 90% of Redux! Everything else from here on out will be handling specific use cases (combining Redux with a React application, how to work with asynchronous data modification, etc.). So we'll be adding more concepts on top of what you know now, so if you feel comfortable with your understanding of Redux, then keep going. If you're a bit hazy on how a specific part works, I definitely recommend you get they hazy bits nailed down now before proceeding on to more complicated content. Feel free to return to the first lesson to review specific Redux functionalities to iron out any confusing parts before moving on.</p>
</div>

</div>
<div class="divider"></div>
          </div>

          <div class="col-12">
            <p class="text-right">
              <a href="05. Summary.html" class="btn btn-outline-primary mt-4" role="button">Next Concept</a>
            </p>
          </div>
        </div>
      </main>

      <footer class="footer">
        <div class="container">
          <div class="row">
            <div class="col-12">
              <p class="text-center">
                <a href="https://us-udacity.github.io/" target="_blank">【udacity2.0 】If you need more courses, please add wechat：udacity6</a>
              </p>
            </div>
          </div>
        </div>
      </footer>
    </div>
  </div>


  <script src="../assets/js/jquery-3.3.1.min.js"></script>
  <script src="../assets/js/plyr.polyfilled.min.js"></script>
  <script src="../assets/js/bootstrap.min.js"></script>
  <script src="../assets/js/jquery.mCustomScrollbar.concat.min.js"></script>
  <script src="../assets/js/katex.min.js"></script>
  <script>
    // Initialize Plyr video players
    const players = Array.from(document.querySelectorAll('video')).map(p => new Plyr(p));

    // render math equations
    let elMath = document.getElementsByClassName('mathquill');
    for (let i = 0, len = elMath.length; i < len; i += 1) {
      const el = elMath[i];

      katex.render(el.textContent, el, {
        throwOnError: false
      });
    }

    // this hack will make sure Bootstrap tabs work when using Handlebars
    if ($('#question-tabs').length && $('#user-answer-tabs').length) {
      $("#question-tabs a.nav-link").on('click', function () {
        $("#question-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
      $("#user-answer-tabs a.nav-link").on('click', function () {
        $("#user-answer-tab-contents .tab-pane").hide();
        $($(this).attr("href")).show();
      });
    } else {
      $("a.nav-link").on('click', function () {
        $(".tab-pane").hide();
        $($(this).attr("href")).show();
      });
    }

    // side bar events
    $(document).ready(function () {
      $("#sidebar").mCustomScrollbar({
        theme: "minimal"
      });

      $('#sidebarCollapse').on('click', function () {
        $('#sidebar, #content').toggleClass('active');
        $('.collapse.in').toggleClass('in');
        $('a[aria-expanded=true]').attr('aria-expanded', 'false');
      });

      // scroll to first video on page loading
      if ($('video').length) {
        $('html,body').animate({ scrollTop: $('div.plyr').prev().offset().top});
      }

      // auto play first video: this may not work with chrome/safari due to autoplay policy
      if (players && players.length > 0) {
        players[0].play();
      }

      // scroll sidebar to current concept
      const currentInSideBar = $( "ul.sidebar-list.components li a:contains('04. This is Redux')" )
      currentInSideBar.css( "text-decoration", "underline" );
      $("#sidebar").mCustomScrollbar('scrollTo', currentInSideBar);
    });
  </script>
</body>

</html>
